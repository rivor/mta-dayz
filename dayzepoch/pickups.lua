itemTable = {
	["farm"] = {
		-- NAME, ID, SIZE
		{"item1",1463,0.4,0,13},
		{"medicine5",1578,0.5,0,4},
		{"fooditem1",2683,1,0,6},
		{"fooditem3",2770,1,0,6},
		{"fooditem4",2601,1,0,6},
		{"fooditem5",2768,1,0,6},
		{"fooditem8",2673,0.5,0,12},
		{"item6",2675,0.5,0,12},
		{"fooditem7",2647,1,0,9},
		{"item10",1650,1,0,10},
		{"helmet3",1747,1,0,1},
		{"helmet5",1749,1,0,2},
		{"helmet6",1750,1,0,1},
		{"helmet7",1751,1,0,1},
		{"vest1",2105,1,0,0.1},
		{"weapon24",335,1,90,4},
		{"toolbelt5",328,0.4,90,8},
		{"medicine8",1579,1,0,4},
		{"item3",1279,1,0,0.5},
		{"medicine6",2709,3,0,3.5},
		{"weapon8",357,1,90,1.25},
		{"weapon22",339,1,90,1.5},
		{"weapon25",1877,1,90,0.1},
		{"vehiclepart3",1073,1,0,2},
		{"clothing3",1241,2,0,2.5},
		{"clothing6",1241,2,0,1},
		{"toolbelt1",1277,0.8,90,6},
		{"toolbelt2",2976,0.15,0,2},
		{"weapon21",1879,1,90,0.5},
		{"weapon17",333,1,90,1.8},
		{"weapon7",349,1,90,3},
	},
	["residential"] = {
		{"toolbelt5",328,0.4,90,5},
		{"weapon21",1879,1,90,1.5},
		{"weapon24",335,1,90,3},
		{"weapon22",339,1,90,1.2},
		{"fooditem9",1582,1,0,7},
		{"fooditem7",2647,1,0,7},
		{"item10",1650,1,0,9},
		{"item5",324,1,90,9},
		{"item11",324,1,90,9},
		{"item12",324,1,90,9},
		{"fooditem6",2856,1,0,7},
		{"medicine6",2709,3,0,7},
		{"fooditem8",2673,0.5,0,12},
		{"item6",2675,0.5,0,12},
		{"weapon19",348,1,90,0.4},
		{"helmet3",1747,1,0,1},
		{"helmet5",1749,1,0,0.1},
		{"helmet6",1750,1,0,1.7},
		{"helmet7",1751,1,0,1.7},
		{"vest1",2105,1,0,0.1},
		{"weapon18",1881,1,90,0.4},
		{"toolbelt3",2710,1,0,3},
		{"weapon25",1877,1,90,0.5},
		{"weapon15",351,1,90,0.6},
		{"medicine4",1576,5,0,6},
		{"item2",933,0.25,0,1},
		{"weapon8",357,1,90,1.1},
		{"backpack2",1575,1,0,0.1},
		{"backpack3",1717,1,0,2},
		{"backpack4",3026,1,0,4},
		{"vehiclepart3",1073,1,0,1},
		{"medicine8",1579,1,0,2},
		{"clothing3",1241,2,0,4},
		{"clothing7",1241,2,0,2},
		{"clothing2",1241,2,0,0.5},
		{"clothing9",1241,2,0,2},
		{"toolbelt1",1277,0.8,90,10},
		{"toolbelt2",2976,0.15,0,3},
		{"fooditem3",2770,1,0,7},
		{"fooditem4",2601,1,0,7},
		{"fooditem5",2768,1,0,7},
		{"weapon17",333,1,90,3},
		{"weapon26",336,1,90,3},
		{"weapon27",337,1,90,3},
	},
	["military"] = {
		{"toolbelt5",328,0.4,90,2},
		{"weapon21",1879,1,90,5},
		{"weapon23",1878,1,90,4},
		{"weapon25",1877,1,90,4},
		{"helmet4",1748,1,0,1},
		{"weapon20",1882,1,90,2.8},
		{"weapon24",335,1,90,2.4},
		{"weapon22",339,1,90,2.1},
		{"helmet7",1751,1,0,0.2},
		{"fooditem9",1582,1,0,2},
		{"fooditem7",2647,1,0,2},
		{"helmet1",1738,1,0,0.5},
		{"vehiclepart4", 1008, 1, 0, 3.5},
		{"vehiclepart5", 1910, 1, 0, 3.2},
		{"vehiclepart2", 1911, 1, 0, 2},
		{"item10",1650,1,0,4},
		{"helmet3",1747,1,0,0.6},
		{"item5",324,1,90,4},
		{"item11",324,1,90,4},
		{"item12",324,1,90,4},
		{"fooditem6",2856,1,0,1},
		{"medicine6",2709,3,0,4},
		{"helmet2",1745,1,0,1.5},
		{"fooditem8",2673,0.5,0,12},
		{"item6",2675,0.5,0,12},
		{"item13",1510,1,90,0.4},
		{"vest1",2105,1,0,0.8},
		{"weapon16",342,1,0,0.25},
		{"weapon19",348,1,90,1.5},
		{"weapon17",333,1,90,1},
		{"weapon11",1830,1,90,2.5},
		{"weapon12",1880,1,90,1},
		{"weapon13",1833,1,90,1.6},
		{"weapon10",1834,1,90,2.1},
		{"helmet5",1749,1,0,0.4},
		{"weapon9",1839,1,90,1.8},
		{"weapon14",1838,1,90,2.8},
		{"weapon2",1869,1,90,0.4},
		{"weapon3",1872,1,90,0.4},
		{"helmet6",1750,1,0,0.45},
		{"weapon5",1874,1,90,0.4},
		{"weapon1",1875,1,90,0.05},
		{"weapon4",1876,1,90,0.4},
		{"vest2",2106,1,0,0.35},
		{"weapon8",357,1,90,0.5},
		{"weapon15",351,1,90,0.1},
		{"weapon18",1881,1,90,2.4},
		{"toolbelt3",2710,1,0,4},
		{"medicine4",1576,5,0,3},
		{"backpack6",1719,1,0,0.5},
		{"backpack7",1725,1,0,0.3},
		{"item2",933,0.25,0,1},
		{"toolbelt7",368,1,90,4},
		{"weapon28",369,1,0,4},
		{"vehiclepart3",1073,1,0,2},
		{"medicine8",1579,1,0,4},
		{"clothing2",1247,2,0,4},
		{"clothing3",1241,2,0,1.5},
		{"clothing8",1241,2,0,0.8},
		{"clothing1",1213,2,0,0.3},
		{"clothing7",1213,2,0,0.6},
		{"clothing9",1213,2,0,0.5},
		{"toolbelt2",2976,0.15,0,3},
		{"toolbelt1",1277,0.8,90,7},
		{"toolbelt4",2969,0.5,0,1},
		--{"toolbelt9",2969,0.5,0,1},
		{"vehiclepart1",929,0.3,0,2},
		{"item3",1279,1,0,4.5},
		{"toolbelt6",369,1,90,1.5},
		{"backpack5",1719,1,0,0.8},
		{"backpack1",1252,1,0,1},
		{"backpack2",1575,1,0,1.5},
		{"backpack3",1717,1,0,3},
		{"backpack4",3026,1,0,4}, 
		{"toolbelt8",330,1,0,6},
		{"weapon27",337,1,90,1},
	},
	["industrial"] = {
		{"item2",933,0.25,0,7},
		{"toolbelt4",2969,0.5,0,3},
		--{"toolbelt9",2969,0.5,0,1.5},
		{"vehiclepart3",1073,1,0,4},
		{"vehiclepart1",929,0.3,0,3.5},
		{"weapon7",349,1,90,3},
		{"fooditem1",2683,1,0,4},
		{"fooditem3",2770,1,0,4},
		{"fooditem4",2601,1,0,4},
		{"fooditem5",2768,1,0,4},
		{"fooditem8",2673,0.5,0,12},
		{"item6",2675,0.5,0,10},
		{"fooditem7",2647,1,0,4},

		{"weapon15",351,1,90,0.1},
		{"item10",1650,1,0,6},
		{"item9",1650,1,0,1.5},
		{"toolbelt1",1277,0.8,90,3},
		{"toolbelt3",2710,1,0,2},
		{"toolbelt5",328,0.4,90,5},
		{"item1",1463,0.4,0,2},
		{"helmet5",1749,1,0,1.2},
		{"helmet6",1750,1,0,0.7},
		{"helmet7",1751,1,0,0.7},
		{"vest1",2105,1,0,1},
		{"vest2",2106,1,0,0.3},
		{"weapon21",1879,1,90,1.5},
		{"weapon20",1882,1,90,2},
		{"weapon24",335,1,90,2},
		{"weapon22",339,1,90,1.5},
		{"vehiclepart4", 1008, 1, 0, 3.5},
		{"vehiclepart5", 1910, 1, 0, 3.5},
		{"vehiclepart2", 1911, 1, 0, 3},
		{"weapon19",348,1,90,1},
		{"fooditem9",1582,1,0,4},
		{"item5",324,1,90,5},
		{"item11",324,1,90,5},
		{"item13",1510,1,90,0.2},
		{"item12",324,1,90,5},
		{"clothing3",1241,2,0,1.5},
		{"clothing8",1241,2,0,0.8},
		{"clothing7",1213,2,0,0.8},
		{"clothing9",1213,2,0,0.8},
		{"fooditem6",2856,1,0,4},
		{"backpack4",3026,1,0,3},
		{"backpack1",1252,1,0,0.7},
		{"backpack5",1719,1,0,0.2},
		{"backpack6",1719,1,0,0.1},
		{"toolbelt8",330,1,0,6},
		{"weapon17",333,1,90,1.5},
		{"weapon26",336,1,90,1.5},
		{"weapon27",337,1,90,1.5},
		{"weapon25",1877,1,90,0.8},
	},
	["supermarket"] = {
		{"fooditem11",2804,0.5,90,8},
		{"toolbelt5",328,0.4,90,5},
		{"item1",1463,0.4,0,5},
		{"weapon21",1879,1,90,3.5},
		{"weapon20",1882,1,90,1.5},
		{"weapon24",335,1,90,3},
		{"weapon22",339,1,90,2.1},
		{"fooditem9",1582,1,0,7},
		{"fooditem7",2647,1,0,7},
		{"item10",1650,1,0,5},
		{"fooditem6",2856,1,0,7},
		{"backpack4",3026,1,0,3},
		{"fooditem3",2770,1,0,7},
		{"fooditem4",2601,1,0,7},
		{"helmet3",1747,1,0,0.8},
		{"helmet6",1750,1,0,1.5},
		{"helmet7",1751,1,0,1},
		{"vest1",2105,1,0,0.5},
		{"fooditem5",2768,1,0,7},
		{"medicine6",2709,3,0,7},
		{"fooditem8",2673,0.5,0,12},
		{"item6",2675,0.5,0,12},
		{"weapon18",1881,1,90,0.5},
		{"toolbelt3",2710,1,0,3},
		{"weapon19",348,1,90,0.5},
		{"medicine4",1576,5,0,6},
		{"item2",933,0.25,0,1},
		{"backpack3",1717,1,0,1.5},
		{"vehiclepart3",1073,1,0,1},
		{"medicine8",1579,1,0,2},
		{"clothing3",1241,2,0,3.5},
		{"clothing7",1241,2,0,1},
		{"clothing8",1241,2,0,0.5},
		{"toolbelt1",1277,0.8,90,4},
		{"toolbelt2",2976,0.15,0,1},
		{"toolbelt8",330,1,0,6},
		{"weapon17",333,1,90,1.9},
		{"weapon26",336,1,90,1.4},
		{"weapon27",337,1,90,0.3}
	},
	["other"] = {
		{"fooditem11",2804,0.5,90},
		{"fooditem10",2806,0.5,90},
		{"item9",1650,1,0},
		{"fooditem2",2683,1,0},
		{"clothing1",1213,2,0,0.01},
		{"clothing2",1247,2,0,4.5},
		{"clothing3",1241,2,0,3.5},
		{"clothing4",1577,2,0},
		{"clothing5",1577,2,0},
		{"clothing6",1577,2,0},
		{"clothing7",1577,2,0},
		{"clothing8",1577,2,0},
		{"clothing9",1213,2,0,0.5},
		{"medicine5",1578,0.5,0,4},
		{"toolbelt7",368,1,90},
		{"toolbelt6",369,1,90},
		{"toolbelt5",328,0.4,90,5},
		{"item1",1463,0.4,0,5},
		{"weapon21",1879,1,90,3.5},
		{"mag1",3013,2,0},
		{"weapon20",1882,1,90,2},
		{"mag3",3013,2,0},
		{"weapon24",335,1,90,2.5},
		{"weapon15",351,1,90,0.4},
		{"weapon22",339,1,90,1.8},
		{"fooditem9",1582,1,0,7},
		{"fooditem7",2647,1,0,7},
		{"item10",1650,1,0,5},
		{"item5",324,1,90,6},
		{"item11",324,1,90,6},
		{"item12",324,1,90,6},
		{"item13",1510,1,90,6},
		{"vehiclepart4", 1008, 1, 0, 3.5},
		{"vehiclepart5", 1910, 1, 0, 3.5},
		{"vehiclepart2", 1911, 1, 0, 3.5},
		{"fooditem6",2856,1,0,5},
		{"medicine6",2709,3,0,7},
		{"fooditem8",2673,0.5,0,12},
		{"item6",2675,0.5,0,12},
		--{"currency1",1210,1.5,0,12},
		--{"currency2",1210,1.5,0,12},
		--{"currency3",1210,1.5,0,12},
		{"item7",363,1,0,12},
		{"item8",343,1,0,12},
		{"weapon18",1881,1,90,1.5},
		{"toolbelt3",2710,1,0,3},
		{"weapon11",1830,1,90,2.4},
		{"weapon12",1880,1,90,1.2},
		{"weapon13",1833,1,90,1.6},
		{"weapon10",1834,1,90,2.4},
		{"weapon14",1838,1,90,2.4},
		{"weapon2",1869,1,90,0.4},
		{"weapon3",1872,1,90,0.4},
		{"weapon5",1874,1,90,0.4},
		{"weapon1",1875,1,90,0.1},
		{"weapon4",1876,1,90,0.4},
		{"medicine4",1576,5,0,6},
		{"item2",933,0.25,0,1},
		{"backpack1",1252,1,0,0.7},
		{"backpack2",1575,1,0,2},
		{"backpack3",1717,1,0,1.5},
		{"backpack4",3026,1,0,6},
		{"backpack6",1719,1,0,0.5},
		{"backpack7",1725,1,0,0.3},
		{"backpack7",1736,1,0,0.7},
		{"helmet1",1738,1,0,0.7},
		{"helmet2",1745,1,0,0.7},
		{"helmet3",1747,1,0,0.7},
		{"helmet4",1748,1,0,0.7},
		{"helmet5",1749,1,0,0.7},
		{"helmet6",1750,1,0,0.7},
		{"helmet7",1751,1,0,0.7},
		{"vest1",2105,1,0,0.7},
		{"vest2",2106,1,0,0.7},
		{"vehiclepart3",1073,1,0,1},
		{"medicine8",1579,1,0,2},
		{"toolbelt1",1277,0.8,90,4},
		{"toolbelt4",2969,0.5,0,3},
		--{"toolbelt9",2969,0.5,0,3},
		{"vehiclepart1",929,0.3,0,3.5},
		{"weapon7",349,1,90,2},
		{"fooditem1",2683,1,0,4},
		{"weapon23",1878,1,90,5},
		{"weapon25",1877,1,90,5},
		{"weapon16",342,1,0,0.5},
		{"weapon28",369,1,0,4},
		{"fooditem3",2770,1,0,5},
		{"fooditem4",2601,1,0,6},
		{"fooditem5",2768,1,0,2},
		{"item3",1279,1,0,0.5},
		{"item4",964,0.4,0,0.5},
		{"weapon19",348,1,90,3},
		{"mag2",3013,2,0},
		{"toolbelt2",2976,0.15,0,1},
		{"medicine1",1908,2.2,0},
		{"medicine2",2891,2.2,0},
		{"medicine3",1909,2.2,0},
		{"medicine7",1580,1,0},
		{"toolbelt8",2966,0.5,0,5},
		{"weapon17",333,1,90,1.9},
		{"weapon26",336,1,90,1.4},
		{"weapon27",337,1,90,1.5},
		{"mag7",2358,2,0},
		{"mag4",1271,2,0},
		{"mag5",1271,2,0},
		{"weapon12",1880,1,90,0.9},
		{"weapon13",1833,1,90,0.9},
		{"weapon10",1834,1,90,0.9},
		{"weapon6",1835,1,90,0.9},
		{"weapon14",1838,1,90,0.9},
		{"mag6",1271,2,0},
		{"mag8",2358,2,0},
		{"mag10",2358,2,0},
		{"mag9",2358,2,0},
		{"weapon8",357,1,90,0.3},
		{"weapon9",1839,1,90,3.8},
	}
};

local weaponAmmoTable = {
	["Weapons"] ={
		{"mag1", "weapon21", 23},
		{"mag1", "weapon23", 23},
		{"mag1", "weapon25", 23},
		{"mag2", "weapon19", 24},
		{"mag3", "weapon20", 29},
		{"mag3", "weapon18", 29},
		{"mag4", "weapon9", 31},
		{"mag4", "weapon10", 31},
		{"mag4", "weapon6", 31},
		{"mag4", "weapon14", 31},
		{"mag5", "weapon11", 31},
		{"mag6", "weapon12", 30},
		{"mag6", "weapon13", 30},
		{"mag7", "weapon7", 25},
		{"mag7", "weapon15", 27},
		{"mag10", "weapon2", 34},
		{"mag8", "weapon3", 34},
		{"mag8", "weapon5", 34},
		{"mag10", "weapon1", 34},
		{"mag8", "weapon4", 34},
		{"mag9", "weapon8", 33}
	},
	["others"] = {
		{"weapon16", 16},
		{"weapon24", 4},
		{"weapon22", 8},
		{"weapon28", 43},
		{"weapon26", 5},
		{"weapon27", 6},
		{"weapon17", 2}
	}
};

local lootrespawn = false;

addEvent("refreshItemLoot", true);
addEvent("onPlayerTakeItemFromGround", true);
addEvent("playerDropAItem", true);
addEvent("onPlayerChangeLoot", true);

function getWeaponAmmoType(weaponName)
	for _,v in ipairs(weaponAmmoTable["Weapons"]) do
		if (weaponName == v[2]) then return v[1], v[3]; end
	end
	for _,v in ipairs(weaponAmmoTable["others"]) do
		if (weaponName == v[1]) then return v[1], v[2]; end
	end
	return false, false;
end

function createItemPickup(item, x, y, z, tableStringName, itemPlus)
	if (item and x and y and z) then
		local object = createObject(itemTable[tostring(tableStringName)][item][2], x, y, z-0.875, itemTable[tostring(tableStringName)][item][4], 0, math.random(0, 360));
		setObjectScale(object, itemTable[tostring(tableStringName)][item][3]);
		setElementCollisionsEnabled(object, false);
		setElementFrozen(object, true);
		local col = createColSphere(x, y, z, 0.75);
		setElementData(col, "item", itemTable[tostring(tableStringName)][item][1]);
		if (itemPlus) then
			setElementData(col, "item2", itemPlus);
		end
		setElementData(col, "parent", object);
		setTimer(function(col, object)
			if isElement(col) then destroyElement(col); end
			if isElement(object) then destroyElement(object); end
		end, 60000*15, 1, col, object);
		return object;
	end
	return false;
end

function math.percentChance(percent, repeatTime)
	local hits = 0;
	for i = 1, repeatTime do
		local number = math.random(0, 200)/2
		if (number <= percent*configVar.lootrate) then hits = hits + 1; end
	end
	return hits;
end

function createItemLoot(lootPlace, x, y, z)
	local col = createColSphere(x, y, z, 1.25);
	setElementData(col, "itemloot", true);
	setElementData(col, "parent", lootPlace);
	setElementData(col, "MAX_Slots", 12);
	for _,v in ipairs(itemTable[lootPlace]) do
		local value = math.percentChance(v[5], math.random(1, 2));
		setElementData(col, v[1], value);
		local ammoData, weapID = getWeaponAmmoType(v[1], true);
		if (ammoData and value > 0) then
			setElementData(col, ammoData, getMagazineSize(ammoData)*math.random(1, 2));
		end
	end
	refreshItemLoot(col, lootPlace);
	return col;
end

function refreshItemLoot(col, place)
	local objects = getElementData(col, "objectsINloot");
	if objects then
		for i = 1, 3 do
			if (objects[i] ~= nil) then destroyElement(objects[i]); end
		end
	end
	local counter = 0;
	local obejctItem = {};
	for _,v in ipairs(itemTable["other"]) do
		if (getElementData(col, v[1]) and getElementData(col, v[1]) > 0) then
			if (counter == 3) then break; end
			counter = counter + 1;
			local x,y,z = getElementPosition(col);
			obejctItem[counter] = createObject(v[2], x+math.random(-1,1), y+math.random(-1,1), z-0.875, v[4]);
			setObjectScale(obejctItem[counter], v[3]);
			setElementCollisionsEnabled(obejctItem[counter], false);
			setElementFrozen(obejctItem[counter], true);
		end
	end
	for i = 1, 3 do
		if (obejctItem[i] == nil) then
			local x,y,z = getElementPosition(col);
			obejctItem[i] = createObject(1463, x+math.random(-1,1), y+math.random(-1,1), z-0.875, 0);
			setObjectScale(obejctItem[i], 0);
			setElementCollisionsEnabled(obejctItem[i], false);
			setElementFrozen(obejctItem[i], true);
		end
	end
	setElementData(col, "objectsINloot", {obejctItem[1], obejctItem[2], obejctItem[3]});
end
addEventHandler("refreshItemLoot", root, refreshItemLoot);

function createLootPickups()
	for k,_ in pairs(pickupPositions) do
		for _,v in ipairs(pickupPositions[k]) do
			createItemLoot(k, v[1], v[2], v[3]);
		end
	end
end

addEventHandler("onPlayerTakeItemFromGround", root, function(itemName, col)
	local itemPlus = 1;
	itemPlus = getMagazineSize(itemName);
	if (getElementData(col, "item2") and (getElementData(col, "item2")/itemPlus) < 1) then
		itemPlus = getElementData(col, "item2");
	end
	setElementData(source, itemName, (getElementData(source, itemName) or 0) + itemPlus);
	destroyElement(getElementData(col, "parent"));
	destroyElement(col);
end);

addEventHandler("onPlayerChangeLoot", root, function(loot)
	for _,v in ipairs(getElementsWithinColShape(loot, "player")) do 
		triggerClientEvent(v, "refreshLootManual", v, loot);
	end
end);

addEventHandler("playerDropAItem", root, function(itemName, itemPlus)
	local x,y,z = getElementPosition(source);
	local item,itemString = getItemTablePosition(itemName);
	createItemPickup(item, x+math.random(-1.25,1.25), y+math.random(-1.25,1.25), z, itemString, itemPlus);
end);

function getItemTablePosition(itema)
	for i,v in ipairs(itemTable["other"]) do
		if (itema == v[1]) then return i, "other"; end
	end
	return v, itemString;
end

function refreshItemLoots()
	lootrespawn = true;
	setServerPassword(tostring(math.random(999999999))..""..tostring(math.random(999999999)));
	for _,v in ipairs(getElementsByType("colshape")) do
		if getElementData(v, "itemloot") then
			local objects = getElementData(v, "objectsINloot");
			if objects then
				if objects[1] then destroyElement(objects[1]); end
				if objects[2] then destroyElement(objects[2]); end
				if objects[3] then destroyElement(objects[3]); end
			end
			destroyElement(v);
		end 
	end
	createLootPickups();
	freezeElements(false);
	setTimer(refreshItemLootPoints, configVar.lootrespawn, 1);
	setServerPassword(nil);
	lootrespawn = false;
end

setTimer(function()
	if (not lootrespawn and getServerPassword()) then
		setServerPassword(nil);
	end
end,5000,0);

function refreshItemLootPoints()
	outputChatBox("#FF0000[Warning] #FFFFFFItem loot respawn in 1 minute!", root, 255, 255, 255, true);
	outputChatBox("#FF0000[Warning] #FFFFFFAll players, vehicles & peds will freez in 50 seconds!", root, 255, 255, 255, true);
	setTimer(freezeElements, 50000, 1, true);
	setTimer(refreshItemLoots, 60000, 1);
end
setTimer(refreshItemLootPoints, configVar.lootrespawn, 1);

function freezeElements(bool)
	for _,v in ipairs(getElementsByType("vehicle")) do
		setElementFrozen(v, bool);
	end
	for _,v in ipairs(getElementsByType("player")) do
		setElementFrozen(v, bool);
	end
	for _,v in ipairs(getElementsByType("ped")) do
		setElementFrozen(v, bool);
	end
end

createLootPickups();